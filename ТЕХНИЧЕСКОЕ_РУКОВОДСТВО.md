# ТЕХНИЧЕСКОЕ РУКОВОДСТВО ПОЛЬЗОВАТЕЛЯ
## ShiwaDiffPHC v1.6.0

---

## 📖 СОДЕРЖАНИЕ

1. [Введение](#введение)
2. [Быстрый старт](#быстрый-старт)
3. [Интерфейс пользователя](#интерфейс-пользователя)
4. [Настройка и конфигурация](#настройка-и-конфигурация)
5. [Измерения и анализ](#измерения-и-анализ)
6. [Расширенный анализ](#расширенный-анализ)
7. [Устранение неполадок](#устранение-неполадок)
8. [Приложения](#приложения)

---

## 🎯 ВВЕДЕНИЕ

ShiwaDiffPHC - это профессиональное программное обеспечение для анализа различий протокола точного времени (PTP). Приложение предназначено для измерения, визуализации и анализа временных различий между PTP устройствами с точностью до наносекунд.

### Основные возможности:
- ✅ Измерение временных различий между PTP устройствами
- ✅ Интерактивная визуализация данных в реальном времени
- ✅ Статистический анализ результатов
- ✅ Расширенный анализ с трендами и спектральным анализом
- ✅ Встроенная синхронизация PTP устройств
- ✅ Экспорт данных в различные форматы

---

## 🚀 БЫСТРЫЙ СТАРТ

### 1. Запуск приложения

```bash
# Переход в директорию проекта
cd /path/to/ShiwaDiffPHC

# Запуск GUI приложения
export DISPLAY=:0
xhost +local:root
sudo -E ./shiwadiffphc-gui
```

### 2. Первоначальная настройка

1. **Выберите PTP устройства** - отметьте минимум 2 устройства в левой панели
2. **Настройте параметры измерения** - количество итераций, интервал
3. **Запустите измерения** - нажмите кнопку "Start Measurement"

### 3. Просмотр результатов

- **📊 Результаты** - таблица с данными измерений
- **📈 Статистика** - статистические показатели
- **📈 Графики** - интерактивные графики
- **📝 Лог** - журнал событий

---

## 🖥️ ИНТЕРФЕЙС ПОЛЬЗОВАТЕЛЯ

### Главное окно

```
┌─────────────────────────────────────────────────────────────┐
│ File  Synchronization  Analysis  Help                       │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────┐ ┌─────────────────────────────────────────┐ │
│ │   Устройства │ │            📊 Результаты                │ │
│ │             │ │                                         │ │
│ │ ☑ PTP0      │ │ Итерация │ Время    │ PTP0-PTP1 │ ... │ │
│ │ ☑ PTP1      │ │    1     │ 10:30:15 │  125.3 μс │ ... │ │
│ │ ☐ PTP2      │ │    2     │ 10:30:16 │  127.1 μс │ ... │ │
│ │ ☐ PTP3      │ │    3     │ 10:30:17 │  124.8 μс │ ... │ │
│ │             │ │                                         │ │
│ │ Итерации: 100│ │                                         │ │
│ │ Интервал: 1с │ │                                         │ │
│ │ ☐ Непрерывно │ │                                         │ │
│ │             │ │                                         │ │
│ │ [Start]     │ │                                         │ │
│ │ [Stop]      │ │                                         │ │
│ │ [Clear]     │ │                                         │ │
│ └─────────────┘ └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ Готов к измерению                    Устройств: 2          │
└─────────────────────────────────────────────────────────────┘
```

### Вкладки интерфейса

#### 📊 Результаты
- **Таблица измерений** - все данные в реальном времени
- **Автоматическая прокрутка** - к последним результатам
- **Форматирование значений** - в микросекундах/наносекундах

#### 📈 Статистика
- **Медиана** - центральное значение
- **Среднее** - арифметическое среднее
- **Мин/Макс** - экстремальные значения
- **Размах** - разность между максимумом и минимумом
- **Стандартное отклонение** - мера разброса
- **Количество измерений** - общее число точек

#### 📈 Графики
- **Интерактивные графики** - масштабирование и панорамирование
- **Множественные серии** - для каждой пары устройств
- **Динамические оси** - автоматическая настройка диапазонов
- **Темная тема** - профессиональное оформление

#### 📝 Лог
- **Журнал событий** - все операции и ошибки
- **Временные метки** - точное время событий
- **Ограничение размера** - последние 1000 записей

---

## ⚙️ НАСТРОЙКА И КОНФИГУРАЦИЯ

### Меню File

#### Load Configuration
```json
{
  "devices": [0, 1, 2],
  "iterations": 1000,
  "interval": 1.0,
  "continuous": false,
  "ptp_domain": 0,
  "ptp_profile": "IEEE_1588"
}
```

#### Save Configuration
- Сохранение текущих настроек
- Формат: JSON
- Расширение: `.json`

#### Save Results
- Экспорт данных измерений
- Форматы: CSV, JSON
- Включает все статистические данные

### Меню Synchronization

#### Sync PTP Devices
1. **Обнаружение устройств** - автоматический поиск PTP устройств
2. **Выбор интерфейса** - сетевой интерфейс для синхронизации
3. **Настройка параметров** - домен, профиль, приоритет
4. **Запуск синхронизации** - активация PTP демона

#### Show Sync Status
- **Статус синхронизации** - текущее состояние
- **Информация об устройствах** - детали конфигурации
- **Метрики качества** - точность и стабильность

### Параметры измерения

#### Количество итераций
- **Ограниченные измерения** - фиксированное число
- **Непрерывный режим** - бесконечные измерения
- **Диапазон:** 1 - 1,000,000

#### Интервал измерений
- **Частота измерений** - время между итерациями
- **Диапазон:** 0.1 - 60 секунд
- **Рекомендуемое значение:** 1 секунда

#### Выбор устройств
- **Максимум:** 8 устройств
- **Минимум:** 2 устройства
- **Автоматическое обнаружение** - поиск доступных PTP устройств

---

## 📊 ИЗМЕРЕНИЯ И АНАЛИЗ

### Процесс измерения

1. **Инициализация** - подготовка к измерениям
2. **Синхронизация** - установка временной базы
3. **Измерения** - сбор данных о временных различиях
4. **Обработка** - расчет статистических показателей
5. **Визуализация** - отображение результатов

### Типы данных

#### Временные различия
- **Единицы:** наносекунды (нс), микросекунды (μс)
- **Диапазон:** ±1 секунда
- **Точность:** 1 наносекунда

#### Статистические показатели
- **Медиана** - устойчивая к выбросам
- **Среднее** - классический показатель
- **Стандартное отклонение** - мера стабильности
- **Размах** - общий разброс значений

### Интерпретация результатов

#### Нормальные значения
- **Различия < 1 мс** - отличная синхронизация
- **Различия 1-10 мс** - хорошая синхронизация
- **Различии 10-100 мс** - приемлемая синхронизация
- **Различия > 100 мс** - требуется настройка

#### Признаки проблем
- **Большой размах** - нестабильная сеть
- **Систематический дрейф** - проблемы с часами
- **Периодические скачки** - сетевые помехи
- **Отсутствие данных** - проблемы с PTP

---

## 🔬 РАСШИРЕННЫЙ АНАЛИЗ

### Trend Analysis (Анализ трендов)

#### Параметры тренда
- **Наклон** - скорость изменения (нс/сек)
- **Пересечение** - начальное значение (нс)
- **R²** - коэффициент детерминации (0-1)
- **Корреляция** - сила связи (-1 до +1)
- **P-значение** - статистическая значимость

#### Типы трендов
- **Stable** - стабильный (наклон ≈ 0)
- **Increasing** - возрастающий (наклон > 0)
- **Decreasing** - убывающий (наклон < 0)

### Spectral Analysis (Спектральный анализ)

#### Частотные характеристики
- **Доминирующая частота** - основная частота колебаний
- **Общая мощность** - энергия сигнала
- **Частотные полосы:**
  - Низкие частоты (< 0.1 Гц)
  - Средние частоты (0.1-1 Гц)
  - Высокие частоты (> 1 Гц)

### Anomaly Detection (Детекция аномалий)

#### Методы обнаружения
- **IQR метод** - межквартильный размах
- **Z-score** - стандартизированные отклонения
- **Modified Z-score** - устойчивый к выбросам

#### Параметры аномалий
- **Порог детекции** - чувствительность алгоритма
- **Количество аномалий** - найденные выбросы
- **Процент аномалий** - доля выбросов
- **Индексы аномалий** - позиции выбросов

---

## 🔧 УСТРАНЕНИЕ НЕПОЛАДОК

### Проблемы с запуском

#### GUI не отображается
```bash
# Проверка дисплея
echo $DISPLAY

# Настройка прав доступа
xhost +local:root

# Запуск с правильными правами
sudo -E ./shiwadiffphc-gui
```

#### Ошибки компиляции
```bash
# Установка зависимостей
sudo apt install qt5-default libqt5charts5-dev build-essential

# Очистка и пересборка
make clean && make
```

### Проблемы с PTP

#### Устройства не обнаружены
1. **Проверка сетевого подключения**
2. **Настройка PTP демона**
3. **Проверка прав доступа**
4. **Анализ логов системы**

#### Ошибки синхронизации
1. **Проверка конфигурации PTP**
2. **Анализ сетевого трафика**
3. **Настройка временных зон**
4. **Проверка аппаратных часов**

### Проблемы с измерениями

#### Неточные результаты
1. **Калибровка системы**
2. **Оптимизация сетевых параметров**
3. **Проверка стабильности сети**
4. **Настройка PTP профиля**

#### Медленная работа
1. **Ограничение количества устройств**
2. **Увеличение интервала измерений**
3. **Оптимизация настроек GUI**
4. **Проверка системных ресурсов**

---

## 📋 ПРИЛОЖЕНИЯ

### A. Форматы данных

#### CSV формат
```csv
Iteration,Timestamp,PTP0-PTP1,PTP0-PTP2,PTP1-PTP2
1,2024-09-12 10:30:15.123,125.3,234.7,109.4
2,2024-09-12 10:30:16.124,127.1,236.2,109.1
```

#### JSON формат
```json
{
  "metadata": {
    "version": "1.6.0",
    "timestamp": "2024-09-12T10:30:15Z",
    "devices": [0, 1, 2],
    "iterations": 100
  },
  "data": [
    {
      "iteration": 1,
      "timestamp": 1726128615123,
      "differences": [125.3, 234.7, 109.4]
    }
  ]
}
```

### B. Конфигурационные файлы

#### ptp4l.conf
```ini
[global]
domainNumber 0
priority1 128
priority2 128
clockClass 248
clockAccuracy 0x31
offsetScaledLogVariance 0xFFFF
free_running 0
freq_est_interval 1
dscp_event 0
dscp_general 0
dataset_comparison ieee1588
G.8275.defaultDS.localPriority 128
```

### C. Командная строка

#### Основные команды
```bash
# Запуск GUI
./shiwadiffphc-gui

# Запуск CLI
./shiwadiffphc-cli --devices 0,1,2 --iterations 100

# Помощь
./shiwadiffphc --help
```

#### Параметры CLI
- `--devices` - список устройств (через запятую)
- `--iterations` - количество итераций
- `--interval` - интервал измерений (сек)
- `--output` - файл для сохранения результатов
- `--config` - файл конфигурации

---

## 📞 ПОДДЕРЖКА

### Контакты
- **Разработчик:** Shiwa Time Systems
- **Версия:** 1.6.0
- **Документация:** Встроенная справка

### Полезные ссылки
- **Руководство пользователя:** README.md
- **Решение проблем:** TROUBLESHOOTING.md
- **План развития:** ROADMAP.md
- **Паспорт изделия:** ПАСПОРТ_ИЗДЕЛИЯ.md

---

*Документ подготовлен: Сентябрь 2024*  
*Версия документа: 1.0*  
*Статус: Действующий*
